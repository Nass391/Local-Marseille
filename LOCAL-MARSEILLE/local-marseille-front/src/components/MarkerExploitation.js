import React, { useState, useEffect } from 'react';
import { Marker, Popup } from 'react-map-gl';
import { getAllProducteurs } from '../api/apiProducteur'
import LogoFarm from "./Navbar/farm.png";

const MarkerExploitation = () => {
    const [producteurs, setProducteurs] = useState([])
    const [showPopup, setShowPopup] = React.useState(true);
    const [popupInfo, setPopupInfo] = useState(null);

    useEffect(() => {
        getAllProducteurs().then((response) => { setProducteurs(response) })
    }, []);

    return producteurs.map(producteur => (
        <Marker latitude={producteur.latitude} longitude={producteur.longitude} color="green" 
            onClick={e => {
                // If we let the click event propagates to the map, it will immediately close the popup
                // with `closeOnClick: true`
                console.log(producteur);
                e.originalEvent.stopPropagation();
                setPopupInfo(producteur);
            }}>
            {popupInfo && (
                <Popup anchor="top"
                    longitude={Number(popupInfo.longitude)}
                    latitude={Number(popupInfo.latitude)}
                    onClose={() => setPopupInfo(null)}>
                    <h5>{popupInfo.nom_exploitation}</h5>
                    <div>{popupInfo.nom} {popupInfo.prenom}</div>
                    
                    <ul>
                        {popupInfo.produits.map(producteursproduits => {
                        return (
                            <li>
                                {producteursproduits.label} 
                            </li>
                        ) 
                        })}
                    </ul>
                </Popup>)}
        </Marker>
    ))
}
export default MarkerExploitation;